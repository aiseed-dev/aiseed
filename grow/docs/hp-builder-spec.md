# ホームページ作成機能（HP Builder）仕様書

作成日：2025年1月16日

---

## 1. 概要

### 1.1 目的

栽培記録アプリ（Grow）に蓄積されたデータ（植物情報、観察記録、写真）を活用し、農家がAIと対話しながら販売用ホームページを作成できる機能を提供する。

### 1.2 コンセプト

- **音声入力優先**: 畑作業中でも指示できるよう、音声入力を主要なインターフェースとする
- **データ活用**: 既存の栽培記録から情報を自動抽出し、プロンプトに含める
- **コピペ方式**: 外部AI（Claude、ChatGPT等）にプロンプトをコピペする既存方式を踏襲
- **シンプル**: 複雑な設定なしで、話しかけるだけでホームページが作れる

---

## 2. ユーザーフロー

```
┌─────────────────────────────────────────────────────────────────┐
│  1. HP作成画面を開く                                              │
│     └─ 栽培記録データを自動読み込み                                │
├─────────────────────────────────────────────────────────────────┤
│  2. 音声またはテキストで指示                                       │
│     例：「イタリア風のおしゃれなホームページを作って」              │
│     例：「今週採れる野菜を載せたい」                                │
│     例：「トマトとズッキーニをメインに」                           │
├─────────────────────────────────────────────────────────────────┤
│  3. プロンプト生成                                                 │
│     └─ 栽培記録 + 音声指示 → AIへのプロンプト                      │
├─────────────────────────────────────────────────────────────────┤
│  4. 外部AIでHTML生成                                              │
│     └─ プロンプトをコピー → Claude/ChatGPTにペースト               │
├─────────────────────────────────────────────────────────────────┤
│  5. HTMLを受け取り                                                 │
│     └─ 生成されたHTMLをアプリにペースト                            │
├─────────────────────────────────────────────────────────────────┤
│  6. プレビュー・保存                                               │
│     └─ WebViewでプレビュー → ファイルとして保存・共有              │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 機能要件

### 3.1 音声入力

| 項目 | 説明 |
|------|------|
| パッケージ | speech_to_text |
| 対応言語 | 日本語（ja-JP）、英語（en-US） |
| UI | マイクボタン押下で録音開始・終了 |
| フィードバック | 録音中はアニメーション表示 |
| フォールバック | 音声認識失敗時はテキスト入力に切り替え |

### 3.2 プロンプト生成

栽培記録から以下の情報を自動抽出してプロンプトに含める：

| データ | 用途 |
|--------|------|
| 植物リスト | 栽培中の野菜一覧 |
| 栽培方法 | 農法（自然農法など）の説明 |
| 観察記録 | 最近の様子、特徴的なエピソード |
| 写真メタデータ | 利用可能な写真のリスト |
| 栽培場所 | 畑の特徴、土壌情報 |

### 3.3 プロンプトテンプレート

```
あなたはプロのWebデザイナーです。
以下の農家情報を元に、販売用ホームページのHTMLを作成してください。

## 農家情報
- 栽培方法: {farming_method}
- 栽培場所: {field_info}
- 栽培中の野菜: {plant_list}
- 最近の様子: {recent_observations}

## ユーザーの要望
{user_request}

## 出力形式
- 単一のHTMLファイル（CSS埋め込み）
- レスポンシブ対応
- 日本語
- 画像は images/ ディレクトリを参照
```

### 3.4 HTMLプレビュー・管理

| 機能 | 説明 |
|------|------|
| プレビュー | webview_flutter でHTML表示 |
| 保存 | ローカルストレージに保存 |
| エクスポート | ファイルとして共有（share_plus） |
| 履歴 | 過去に生成したHTMLの一覧管理 |

---

## 4. 画面設計

### 4.1 HP作成画面（HpBuilderScreen）

```
┌──────────────────────────────────────┐
│ ← ホームページ作成                    │
├──────────────────────────────────────┤
│                                      │
│  ┌────────────────────────────────┐  │
│  │ 栽培記録から読み込み済み        │  │
│  │ ・トマト（自然栽培）            │  │
│  │ ・ズッキーニ（自然栽培）        │  │
│  │ ・バジル（自然栽培）            │  │
│  └────────────────────────────────┘  │
│                                      │
│  どんなホームページにしますか？       │
│  ┌────────────────────────────────┐  │
│  │                                │  │
│  │     （音声入力のテキスト）       │  │
│  │                                │  │
│  └────────────────────────────────┘  │
│                                      │
│         🎤 タップして話す            │
│                                      │
│  ────────────────────────────────── │
│                                      │
│  [プロンプトを生成]                   │
│                                      │
└──────────────────────────────────────┘
```

### 4.2 プロンプト画面（HpPromptScreen）

```
┌──────────────────────────────────────┐
│ ← AIへのプロンプト                    │
├──────────────────────────────────────┤
│                                      │
│  ┌────────────────────────────────┐  │
│  │ あなたはプロのWebデザイナー    │  │
│  │ です。以下の農家情報を元に... │  │
│  │                                │  │
│  │ ## 農家情報                    │  │
│  │ - 栽培方法: 自然栽培           │  │
│  │ ...                            │  │
│  └────────────────────────────────┘  │
│                                      │
│  [📋 プロンプトをコピー]              │
│                                      │
│  ↓ AIが生成したHTMLをペースト        │
│                                      │
│  ┌────────────────────────────────┐  │
│  │                                │  │
│  │   （HTMLペースト欄）           │  │
│  │                                │  │
│  └────────────────────────────────┘  │
│                                      │
│  [プレビュー]                        │
│                                      │
└──────────────────────────────────────┘
```

### 4.3 プレビュー画面（HpPreviewScreen）

```
┌──────────────────────────────────────┐
│ ← プレビュー              [💾][📤]   │
├──────────────────────────────────────┤
│                                      │
│  ┌────────────────────────────────┐  │
│  │                                │  │
│  │      （WebViewでHTML表示）     │  │
│  │                                │  │
│  │                                │  │
│  │                                │  │
│  │                                │  │
│  │                                │  │
│  │                                │  │
│  └────────────────────────────────┘  │
│                                      │
│  [🎤 修正を指示]  [✓ 保存して完了]   │
│                                      │
└──────────────────────────────────────┘
```

---

## 5. 音声入力の使用例

農家が使いやすいよう、自然な日本語での指示に対応：

| 音声入力例 | 解釈 |
|------------|------|
| 「シンプルなホームページを作って」 | スタイル: ミニマル |
| 「イタリアンな雰囲気で」 | スタイル: イタリアンカラー |
| 「今週の野菜ページを追加して」 | ページ追加: 商品一覧 |
| 「トマトの写真を大きく」 | レイアウト変更 |
| 「連絡先を入れて」 | セクション追加: お問い合わせ |
| 「もう少し緑を濃くして」 | 色調整 |

---

## 6. 技術仕様

### 6.1 追加パッケージ

```yaml
dependencies:
  speech_to_text: ^6.6.0      # 音声認識
  webview_flutter: ^4.4.0     # HTMLプレビュー
  share_plus: ^7.2.0          # ファイル共有
  path_provider: ^2.1.0       # ファイルパス取得
```

### 6.2 ファイル構成

```
lib/features/hp_builder/
├── hp_builder_screen.dart      # メイン画面（音声入力）
├── hp_prompt_screen.dart       # プロンプト表示・HTMLペースト
├── hp_preview_screen.dart      # HTMLプレビュー
├── widgets/
│   ├── voice_input_button.dart # 音声入力ボタン
│   └── plant_summary_card.dart # 栽培記録サマリー
└── services/
    ├── prompt_generator.dart   # プロンプト生成
    └── hp_repository.dart      # HTML保存・管理
```

### 6.3 権限（iOS/Android）

| 権限 | 用途 |
|------|------|
| マイク | 音声入力 |
| ストレージ | HTMLファイル保存 |

---

## 7. 将来の拡張

| 機能 | 説明 |
|------|------|
| 写真自動配置 | 栽培記録の写真をHTMLに自動埋め込み |
| テンプレート | よく使うデザインパターンの保存 |
| 公開連携 | Cloudflare Pagesへの直接デプロイ |
| 多言語HP | 英語版ホームページの自動生成 |

---

## 8. 関連ドキュメント

- grow-spec.md セクション6.3「販売用ホームページへの活用」
- grow/docs/farm/ サンプルHP
